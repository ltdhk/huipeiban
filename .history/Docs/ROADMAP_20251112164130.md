# CareLink 项目开发路线图

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | 2025-11-12 |
| 项目启动 | 2025-11-12 |
| 预计上线 | 2026-02-12 (3个月后) |

---

## 一、项目阶段概览

```
Phase 1: 基础架构搭建 (4周)
    ↓
Phase 2: 核心功能开发 (6周)
    ↓
Phase 3: 测试与优化 (2周)
    ↓
Phase 4: 上线部署 (1周)
```

---

## 二、Phase 1 - 基础架构搭建 (Week 1-4)

### 目标
搭建项目基础架构，完成开发环境配置。

### Week 1: 项目初始化

#### 后端 (Backend)

- [x] 技术栈选型完成
- [x] 初始化 Flask 项目
  - [x] 创建项目目录结构
  - [x] 配置虚拟环境
  - [x] 安装核心依赖（Flask, SQLAlchemy, Flask-JWT-Extended）
- [x] 配置开发环境
  - [x] 配置 `.env` 文件
  - [x] 配置 `config.py`
  - [x] 设置日志系统
- [x] 数据库初始化
  - [x] 配置 PostgreSQL 连接
  - [x] 创建数据库迁移环境（Flask-Migrate）
  - [x] 创建基础表结构
- [x] Git 仓库初始化
  - [x] 初始化 Git 仓库
  - [x] 配置 `.gitignore`
  - [x] 创建 `main` 和 `develop` 分支
  - [x] 第一次提交

#### 前端 - 小程序 (MiniApp)

- [x] 清理 TDesign 模板代码
  - [ ] 保留 TDesign 组件库依赖
  - [ ] 删除演示页面
  - [ ] 创建业务页面目录结构
- [ ] 配置小程序基础信息
  - [ ] 配置 `app.json`（页面路由、TabBar）
  - [ ] 配置 `project.config.json`
  - [ ] 设置主题色和全局样式
- [ ] 创建公共组件
  - [ ] 创建 `service-card` 组件
  - [ ] 创建 `order-card` 组件
  - [ ] 创建 `message-bubble` 组件
- [ ] 配置 API 请求封装
  - [ ] 封装 `request.js` 工具函数
  - [ ] 配置请求拦截器
  - [ ] 配置 Token 管理

#### 前端 - 管理后台 (Admin)

- [ ] 初始化 React 项目
  - [ ] 使用 Vite 创建项目
  - [ ] 安装 Ant Design 5
  - [ ] 配置 TypeScript
- [ ] 配置路由
  - [ ] 安装 React Router
  - [ ] 配置路由结构
  - [ ] 创建布局组件
- [ ] 配置 API 请求
  - [ ] 配置 Axios
  - [ ] 配置请求/响应拦截器
  - [ ] 配置 Token 管理

### Week 2: 核心模型与认证

#### 后端

- [ ] 实现数据模型
  - [ ] 创建 User 模型
  - [ ] 创建 Companion 模型
  - [ ] 创建 Institution 模型
  - [ ] 创建 Order 模型
  - [ ] 运行数据库迁移
- [ ] 实现认证系统
  - [ ] 实现微信登录接口
  - [ ] 实现 JWT Token 生成与验证
  - [ ] 实现 Refresh Token 机制
  - [ ] 创建认证装饰器
- [ ] API 文档生成
  - [ ] 配置 Flask-RESTX
  - [ ] 生成 Swagger 文档

#### 前端 - 小程序

- [ ] 实现登录页面
  - [ ] 创建登录页面 UI
  - [ ] 调用微信登录接口
  - [ ] 存储 Token
- [ ] 实现首页框架
  - [ ] 创建侧边栏导航
  - [ ] 创建 AI 对话入口
  - [ ] 创建快捷功能入口

#### 前端 - 管理后台

- [ ] 实现登录页面
  - [ ] 创建登录表单
  - [ ] 实现登录逻辑
  - [ ] 存储 Token
- [ ] 实现主布局
  - [ ] 创建侧边菜单
  - [ ] 创建顶部导航
  - [ ] 创建面包屑

### Week 3: AI Agent 基础框架

#### 后端

- [ ] 搭建 AI Agent 框架
  - [ ] 配置 LangChain
  - [ ] 配置 OpenRouter
  - [ ] 创建 Agent 基础类
  - [ ] 实现对话状态管理
- [ ] 实现 AI 对话接口
  - [ ] 创建 `/api/v1/user/ai/chat` 接口
  - [ ] 实现会话管理
  - [ ] 存储对话历史到数据库
- [ ] 编写提示词模板
  - [ ] System Prompt
  - [ ] 意图识别 Prompt
  - [ ] 实体抽取 Prompt

#### 前端 - 小程序

- [ ] 实现 AI 对话页面
  - [ ] 创建对话界面 UI
  - [ ] 实现消息发送
  - [ ] 实现消息展示
  - [ ] 实现消息历史加载

### Week 4: 支付集成准备

#### 后端

- [ ] 配置微信支付
  - [ ] 安装 `wechatpayv3` SDK
  - [ ] 配置商户信息
  - [ ] 下载并配置 API 证书
- [ ] 实现支付服务基础类
  - [ ] 创建 `WeChatPayService` 类
  - [ ] 实现统一下单接口
  - [ ] 实现支付回调处理（框架）
- [ ] 创建 Payment 模型
  - [ ] 运行数据库迁移

---

## 三、Phase 2 - 核心功能开发 (Week 5-10)

### Week 5-6: 陪诊师/机构管理

#### 后端

- [ ] 实现陪诊师相关接口
  - [ ] `GET /api/v1/user/companions` - 获取陪诊师列表
  - [ ] `GET /api/v1/user/companions/:id` - 获取陪诊师详情
  - [ ] `GET /api/v1/user/companions/:id/reviews` - 获取评价列表
- [ ] 实现陪诊机构相关接口
  - [ ] `GET /api/v1/user/institutions` - 获取机构列表
  - [ ] `GET /api/v1/user/institutions/:id` - 获取机构详情
- [ ] 实现推荐算法
  - [ ] 创建 `RecommendationService` 类
  - [ ] 实现陪诊师匹配算法
  - [ ] 实现机构匹配算法

#### 前端 - 小程序

- [ ] 实现陪诊师列表页
  - [ ] 创建列表 UI
  - [ ] 实现筛选功能
  - [ ] 实现排序功能
- [ ] 实现陪诊师详情页
  - [ ] 展示陪诊师信息
  - [ ] 展示服务项目
  - [ ] 展示评价列表
  - [ ] "立即预约"按钮

#### 前端 - 管理后台

- [ ] 实现陪诊师管理页面
  - [ ] 陪诊师列表
  - [ ] 陪诊师详情
  - [ ] 审核功能
  - [ ] 状态管理
- [ ] 实现机构管理页面
  - [ ] 机构列表
  - [ ] 机构详情
  - [ ] 审核功能

### Week 7-8: 订单与支付功能

#### 后端

- [ ] 实现订单相关接口
  - [ ] `POST /api/v1/user/orders` - 创建订单
  - [ ] `GET /api/v1/user/orders` - 获取订单列表
  - [ ] `GET /api/v1/user/orders/:id` - 获取订单详情
  - [ ] `POST /api/v1/user/orders/:id/cancel` - 取消订单
- [ ] 实现支付相关接口
  - [ ] `POST /api/v1/user/payments/create` - 创建支付
  - [ ] `GET /api/v1/user/payments/:id` - 查询支付结果
  - [ ] `POST /api/v1/webhooks/wechat-pay` - 支付回调
- [ ] 实现退款功能
  - [ ] 创建退款接口
  - [ ] 实现退款回调处理
  - [ ] 实现退款手续费计算

#### 前端 - 小程序

- [ ] 实现预约流程页面
  - [ ] 服务详情页
  - [ ] 就诊人选择页
  - [ ] 服务规格选择页
  - [ ] 接送选项页
  - [ ] 订单确认页
- [ ] 实现支付功能
  - [ ] 调用支付接口
  - [ ] 调起微信支付
  - [ ] 处理支付结果
- [ ] 实现订单管理页面
  - [ ] 订单列表（按状态筛选）
  - [ ] 订单详情
  - [ ] 取消订单功能

#### 前端 - 管理后台

- [ ] 实现订单管理页面
  - [ ] 订单列表
  - [ ] 订单详情
  - [ ] 订单备注
  - [ ] 强制取消/退款

### Week 9: AI Agent 完善

#### 后端

- [ ] 完善 AI Agent 功能
  - [ ] 实现意图识别优化
  - [ ] 实现槽位填充优化
  - [ ] 实现推荐结果生成
  - [ ] 集成 Tools（数据库查询、推荐引擎）
- [ ] 实现知识库检索（可选）
  - [ ] 准备 FAQ 数据
  - [ ] 实现向量检索（或关键词匹配）

#### 前端 - 小程序

- [ ] 完善 AI 对话页面
  - [ ] 展示推荐卡片（陪诊师/机构）
  - [ ] 点击卡片进入详情
  - [ ] 快捷回复功能
  - [ ] 优化对话体验

### Week 10: 用户中心与其他功能

#### 后端

- [ ] 实现用户相关接口
  - [ ] `GET /api/v1/user/profile` - 获取用户信息
  - [ ] `PATCH /api/v1/user/profile` - 更新用户信息
  - [ ] 就诊人管理接口
  - [ ] 地址管理接口
- [ ] 实现消息相关接口
  - [ ] 会话列表
  - [ ] 会话消息
  - [ ] 发送消息
- [ ] 实现评价相关接口
  - [ ] 创建评价
  - [ ] 获取评价列表

#### 前端 - 小程序

- [ ] 实现个人中心页面
  - [ ] 个人信息展示
  - [ ] 就诊人管理
  - [ ] 地址管理
  - [ ] 我的收藏
  - [ ] 优惠券管理
- [ ] 实现消息中心
  - [ ] 会话列表
  - [ ] 一对一聊天界面
- [ ] 实现评价功能
  - [ ] 评价表单
  - [ ] 评价展示

#### 前端 - 管理后台

- [ ] 实现用户管理页面
  - [ ] 用户列表
  - [ ] 用户详情
  - [ ] 状态管理
- [ ] 实现评价管理页面
  - [ ] 评价列表
  - [ ] 隐藏/删除评价
- [ ] 实现数据统计页面
  - [ ] 仪表盘
  - [ ] 数据报表
  - [ ] 图表展示

---

## 四、Phase 3 - 测试与优化 (Week 11-12)

### Week 11: 功能测试

#### 后端

- [ ] 单元测试
  - [ ] 编写模型测试
  - [ ] 编写 API 接口测试
  - [ ] 编写支付功能测试
- [ ] 集成测试
  - [ ] 测试完整业务流程
  - [ ] 测试 AI Agent 对话流程
- [ ] 性能测试
  - [ ] 压力测试（使用 Locust）
  - [ ] 数据库查询优化
  - [ ] 添加缓存（Redis）

#### 前端

- [ ] 功能测试
  - [ ] 测试所有页面流程
  - [ ] 测试支付流程
  - [ ] 测试异常情况处理
- [ ] 兼容性测试
  - [ ] 测试不同微信版本
  - [ ] 测试不同手机型号
  - [ ] 测试不同浏览器（管理后台）

### Week 12: Bug修复与优化

#### 后端

- [ ] 修复测试中发现的 Bug
- [ ] 性能优化
  - [ ] 优化慢查询
  - [ ] 添加数据库索引
  - [ ] 优化 AI Agent 响应速度
- [ ] 安全加固
  - [ ] 添加 SQL 注入防护
  - [ ] 添加 XSS 防护
  - [ ] 添加请求频率限制

#### 前端

- [ ] 修复测试中发现的 Bug
- [ ] 性能优化
  - [ ] 优化页面加载速度
  - [ ] 优化图片加载
  - [ ] 减少请求次数
- [ ] 用户体验优化
  - [ ] 优化交互动画
  - [ ] 优化错误提示
  - [ ] 优化加载状态

---

## 五、Phase 4 - 上线部署 (Week 13)

### 部署准备

#### 后端

- [ ] 准备生产环境
  - [ ] 购买服务器（或使用云服务）
  - [ ] 配置 PostgreSQL 数据库
  - [ ] 配置 Redis
  - [ ] 配置 Nginx
- [ ] 部署应用
  - [ ] 配置 Gunicorn
  - [ ] 配置 Supervisor（进程管理）
  - [ ] 配置 HTTPS 证书
- [ ] 数据库迁移
  - [ ] 导入初始数据
  - [ ] 创建管理员账号
- [ ] 监控与日志
  - [ ] 配置日志收集（如 ELK）
  - [ ] 配置监控告警（如 Prometheus + Grafana）

#### 前端 - 小程序

- [ ] 提交审核
  - [ ] 配置小程序信息
  - [ ] 上传小程序代码
  - [ ] 提交审核
  - [ ] 等待审核通过
- [ ] 发布上线
  - [ ] 审核通过后发布
  - [ ] 配置体验版（供内测）

#### 前端 - 管理后台

- [ ] 部署应用
  - [ ] 打包生产版本
  - [ ] 部署到服务器
  - [ ] 配置 Nginx 反向代理

### 上线后监控

- [ ] 监控关键指标
  - [ ] API 响应时间
  - [ ] 错误率
  - [ ] 用户活跃度
  - [ ] 支付成功率
- [ ] 收集用户反馈
  - [ ] 设置反馈渠道
  - [ ] 定期查看反馈
  - [ ] 优先修复严重问题

---

## 六、后续迭代计划

### Phase 5 - 功能增强 (Month 4-6)

#### 优先级 P0（必须做）

- [ ] 完善消息推送
  - [ ] 配置微信小程序订阅消息
  - [ ] 订单状态变更通知
  - [ ] 支付成功通知
- [ ] 优惠券系统完善
  - [ ] 优惠券领取
  - [ ] 优惠券使用
  - [ ] 优惠券管理（后台）
- [ ] 客服系统
  - [ ] 在线客服
  - [ ] 工单系统

#### 优先级 P1（重要）

- [ ] 陪诊师端小程序（独立小程序）
  - [ ] 接单功能
  - [ ] 订单管理
  - [ ] 收入管理
  - [ ] 提现功能
- [ ] 数据分析
  - [ ] 用户行为分析
  - [ ] 订单数据分析
  - [ ] 财务数据分析
- [ ] 营销功能
  - [ ] 拼团功能
  - [ ] 砍价功能
  - [ ] 邀请有礼

#### 优先级 P2（可选）

- [ ] AI Agent 增强
  - [ ] 支持多轮复杂对话
  - [ ] 支持语音输入
  - [ ] 支持图片识别（如识别检查报告）
- [ ] 社区功能
  - [ ] 用户评价社区
  - [ ] 陪诊经验分享
- [ ] 增值服务
  - [ ] 陪诊师培训
  - [ ] 医疗咨询对接

---

## 七、资源分配

### 人员配置（建议）

| 角色 | 人数 | 职责 |
|------|------|------|
| 项目经理 | 1 | 项目管理、进度跟踪 |
| 后端工程师 | 2 | Flask API、AI Agent、数据库 |
| 前端工程师（小程序） | 1 | 微信小程序开发 |
| 前端工程师（Web） | 1 | React 管理后台开发 |
| UI/UX 设计师 | 1 | 界面设计、交互设计 |
| 测试工程师 | 1 | 测试用例、Bug 跟踪 |
| 运维工程师 | 0.5 | 部署、监控（可兼任） |

### 时间分配

| 阶段 | 时间 | 占比 |
|------|------|------|
| Phase 1 - 基础架构 | 4周 | 31% |
| Phase 2 - 核心功能 | 6周 | 46% |
| Phase 3 - 测试优化 | 2周 | 15% |
| Phase 4 - 上线部署 | 1周 | 8% |
| **总计** | **13周** | **100%** |

---

## 八、风险管理

### 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| AI Agent 效果不理想 | 高 | 中 | 提前测试，准备降级方案（人工客服） |
| 微信支付集成问题 | 高 | 低 | 提前阅读文档，使用沙箱测试 |
| 性能瓶颈 | 中 | 中 | 提前性能测试，优化数据库查询 |
| 数据库设计不合理 | 中 | 低 | Code Review，定期审查表结构 |

### 进度风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 需求变更频繁 | 高 | 高 | 锁定核心需求，迭代增加新功能 |
| 人员不足 | 高 | 中 | 提前招聘，外包部分工作 |
| 技术难点耗时 | 中 | 中 | 预留缓冲时间，及时调整计划 |
| 第三方服务不稳定 | 中 | 低 | 选择可靠的服务商，准备备用方案 |

### 业务风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|---------|
| 用户需求不明确 | 高 | 中 | 小范围试运营，收集反馈快速迭代 |
| 竞争对手 | 中 | 高 | 突出 AI Native 差异化优势 |
| 监管政策变化 | 高 | 低 | 持续关注政策，确保合规 |

---

## 九、质量保证

### Code Review

- 所有代码必须经过 Code Review
- 使用 Pull Request 工作流
- 至少 1 人 Approve 才能合并

### 测试覆盖率

- 单元测试覆盖率目标：> 70%
- 核心功能覆盖率：100%
- 关键业务流程必须有集成测试

### 文档要求

- 所有接口必须有 API 文档
- 核心模块必须有设计文档
- 复杂算法必须有注释说明

---

## 十、成功指标

### Phase 1 成功标准

- [x] 项目结构搭建完成
- [ ] 开发环境可正常运行
- [ ] 数据库表结构创建完成
- [ ] 认证系统可正常工作

### Phase 2 成功标准

- [ ] 所有核心 API 接口开发完成
- [ ] 小程序核心页面开发完成
- [ ] AI Agent 基本对话功能可用
- [ ] 支付功能在沙箱环境测试通过

### Phase 3 成功标准

- [ ] 所有功能测试通过
- [ ] 无阻塞性 Bug
- [ ] 性能指标达标（API 响应 < 500ms）

### Phase 4 成功标准

- [ ] 应用成功部署到生产环境
- [ ] 小程序审核通过并上线
- [ ] 监控系统正常运行
- [ ] 完成内部试运营

---

## 十一、检查清单

### 上线前检查清单

#### 后端

- [ ] 所有 API 接口正常工作
- [ ] 数据库索引优化完成
- [ ] 敏感信息加密存储
- [ ] API 密钥配置正确
- [ ] 支付回调 URL 配置正确
- [ ] 日志系统正常工作
- [ ] 监控告警配置完成
- [ ] 备份策略已实施

#### 前端 - 小程序

- [ ] 所有页面功能正常
- [ ] 支付流程测试通过
- [ ] 用户隐私协议已添加
- [ ] 服务条款已添加
- [ ] AppID 配置正确
- [ ] 域名白名单配置完成

#### 前端 - 管理后台

- [ ] 所有功能模块正常
- [ ] 权限控制正确
- [ ] HTTPS 配置完成

### 每周检查清单

- [ ] 查看本周任务完成情况
- [ ] 更新项目进度
- [ ] 记录遇到的问题
- [ ] 调整下周计划
- [ ] 团队周会 Sync

---

## 十二、附录

### A. 依赖包清单

#### 后端 Python 依赖

```txt
Flask==3.0.0
Flask-SQLAlchemy==3.1.1
Flask-Migrate==4.0.5
Flask-JWT-Extended==4.6.0
Flask-RESTX==1.3.0
psycopg2-binary==2.9.9
python-dotenv==1.0.0
langchain==0.1.0
openai==1.6.1
wechatpayv3==1.2.0
redis==5.0.1
celery==5.3.4
gunicorn==21.2.0
```

#### 前端小程序依赖

```json
{
  "dependencies": {
    "tdesign-miniprogram": "latest"
  }
}
```

#### 前端 Web 依赖

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "antd": "^5.12.0",
    "axios": "^1.6.0",
    "@ant-design/icons": "^5.2.6"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0"
  }
}
```

### B. 环境变量模板

```bash
# .env.example

# Flask
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=your-secret-key-here

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/carelink

# Redis
REDIS_URL=redis://localhost:6379/0

# WeChat
WECHAT_APPID=your-appid
WECHAT_APP_SECRET=your-app-secret

# WeChat Pay
WECHAT_PAY_MCHID=your-mchid
WECHAT_PAY_SERIAL_NO=your-serial-no
WECHAT_PAY_API_V3_KEY=your-api-v3-key
WECHAT_PAY_PRIVATE_KEY_PATH=/path/to/key.pem
WECHAT_PAY_NOTIFY_URL=https://api.yourdomain.com/webhooks/wechat-pay

# OpenRouter
OPENROUTER_API_KEY=your-openrouter-api-key

# JWT
JWT_SECRET_KEY=your-jwt-secret-key
JWT_ACCESS_TOKEN_EXPIRES=7200
JWT_REFRESH_TOKEN_EXPIRES=604800
```

---

**文档结束**

祝项目开发顺利！🎉
